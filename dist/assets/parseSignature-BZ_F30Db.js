import{O as k,bS as T,bF as B,a6 as N,bU as x,cg as v,cd as P,dQ as F,cf as y,dR as _,_ as R,dS as A,a5 as O,dT as $,bu as L,c9 as U,c6 as S,dU as W,c4 as M,b$ as H,b_ as z,a7 as E,cK as j,dV as D,dW as V,dX as q,cA as K,dY as G,l as Q,m as X,dZ as Y}from"./index-B4Jp5nYj.js";function ae(t,e){if(t.length!==e.length)throw new k({expectedLength:t.length,givenLength:e.length});const a=[];for(let r=0;r<t.length;r++){const l=t[r],o=e[r];a.push(I(l,o))}return T(a)}function I(t,e,a=!1){if(t==="address"){const i=e;if(!B(i))throw new N({address:i});return x(i.toLowerCase(),{size:a?32:null})}if(t==="string")return v(e);if(t==="bytes")return e;if(t==="bool")return x(P(e),{size:a?32:1});const r=t.match(F);if(r){const[i,n,c="256"]=r,u=Number.parseInt(c,10)/8;return y(e,{size:a?32:u,signed:n==="int"})}const l=t.match(_);if(l){const[i,n]=l;if(Number.parseInt(n,10)!==(e.length-2)/2)throw new R({expectedSize:Number.parseInt(n,10),givenSize:(e.length-2)/2});return x(e,{dir:"right",size:a?32:null})}const o=t.match(A);if(o&&Array.isArray(e)){const[i,n]=o,c=[];for(let u=0;u<e.length;u++)c.push(I(n,e[u],!0));return c.length===0?"0x":T(c)}throw new O(t)}function ie(t){const{source:e}=t,a=new Map,r=new $(8192),l=new Map,o=({address:i,chainId:n})=>`${i}.${n}`;return{async consume({address:i,chainId:n,client:c}){const u=o({address:i,chainId:n}),s=this.get({address:i,chainId:n,client:c});this.increment({address:i,chainId:n});const h=await s;return await e.set({address:i,chainId:n},h),r.set(u,h),h},async increment({address:i,chainId:n}){const c=o({address:i,chainId:n}),u=a.get(c)??0;a.set(c,u+1)},async get({address:i,chainId:n,client:c}){const u=o({address:i,chainId:n});let s=l.get(u);return s||(s=(async()=>{try{const m=await e.get({address:i,chainId:n,client:c}),f=r.get(u)??0;return f>0&&m<=f?f+1:(r.delete(u),m)}finally{this.reset({address:i,chainId:n})}})(),l.set(u,s)),(a.get(u)??0)+await s},reset({address:i,chainId:n}){const c=o({address:i,chainId:n});a.delete(c),l.delete(c)}}}const Z="0x6492649264926492649264926492649264926492649264926492649264926492";function oe(t){const{address:e,data:a,signature:r,to:l="hex"}=t,o=T([L([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,a,r]),Z]);return l==="hex"?o:U(o)}const J="0x5792579257925792579257925792579257925792579257925792579257925792",ee=y(0,{size:32});async function te(t,e){async function a(s){if(s.endsWith(J.slice(2))){const m=H(z(s,-64,-32)),f=z(s,0,-64).slice(2).match(/.{1,64}/g),p=await Promise.all(f.map(d=>ee.slice(2)!==d?t.request({method:"eth_getTransactionReceipt",params:[`0x${d}`]},{dedupe:!0}):void 0)),g=p.some(d=>d===null)?100:p.every(d=>(d==null?void 0:d.status)==="0x1")?200:p.every(d=>(d==null?void 0:d.status)==="0x0")?500:600;return{atomic:!1,chainId:S(m),receipts:p.filter(Boolean),status:g,version:"2.0.0"}}return t.request({method:"wallet_getCallsStatus",params:[s]})}const{atomic:r=!1,chainId:l,receipts:o,version:i="2.0.0",...n}=await a(e.id),[c,u]=(()=>{const s=n.status;return s>=100&&s<200?["pending",s]:s>=200&&s<300?["success",s]:s>=300&&s<700?["failure",s]:s==="CONFIRMED"?["success",200]:s==="PENDING"?["pending",100]:[void 0,s]})();return{...n,atomic:r,chainId:l?S(l):void 0,receipts:(o==null?void 0:o.map(s=>({...s,blockNumber:M(s.blockNumber),gasUsed:M(s.gasUsed),status:W[s.status]})))??[],statusCode:u,status:c,version:i}}class se extends E{constructor(e){super(`Call bundle failed with status: ${e.statusCode}`,{name:"BundleFailedError"}),Object.defineProperty(this,"result",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.result=e}}async function ce(t,e){const{id:a,pollingInterval:r=t.pollingInterval,status:l=({statusCode:g})=>g===200||g>=300,retryCount:o=4,retryDelay:i=({count:g})=>~~(1<<g)*200,timeout:n=6e4,throwOnFailure:c=!1}=e,u=j(["waitForCallsStatus",t.uid,a]),{promise:s,resolve:h,reject:m}=D();let f;const p=V(u,{resolve:h,reject:m},g=>{const d=q(async()=>{const C=b=>{clearTimeout(f),d(),b(),p()};try{const b=await K(async()=>{const w=await G(t,te,"getCallsStatus")({id:a});if(c&&w.status==="failure")throw new se(w);return w},{retryCount:o,delay:i});if(!l(b))return;C(()=>g.resolve(b))}catch(b){C(()=>g.reject(b))}},{interval:r,emitOnBegin:!0});return d});return f=n?setTimeout(()=>{p(),clearTimeout(f),m(new ne({id:a}))},n):void 0,await s}class ne extends E{constructor({id:e}){super(`Timed out while waiting for call bundle with id "${e}" to be confirmed.`,{name:"WaitForCallsStatusTimeoutError"})}}function ue(t){const{key:e="public",name:a="Public Client"}=t;return Q({...t,key:e,name:a,type:"publicClient"}).extend(X)}function le(t){const{r:e,s:a}=Y.Signature.fromCompact(t.slice(2,130)),r=+`0x${t.slice(130)}`,[l,o]=(()=>{if(r===0||r===1)return[void 0,r];if(r===27)return[BigInt(r),0];if(r===28)return[BigInt(r),1];throw new Error("Invalid yParityOrV value")})();return typeof l<"u"?{r:y(e,{size:32}),s:y(a,{size:32}),v:l,yParity:o}:{r:y(e,{size:32}),s:y(a,{size:32}),yParity:o}}export{se as B,ne as W,ie as a,ue as c,ae as e,le as p,oe as s,ce as w};
